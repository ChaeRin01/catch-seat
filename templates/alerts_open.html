{% extends "base.html" %}
{% block content %}
<h1>오픈 알림 신청</h1>

<form method="post">
  <!-- 영화 -->
  <label>영화</label>
  <select name="movie" required>
    <option value="">-- 영화 선택 --</option>
    {% for mv in movies %}
      <option value="{{ mv }}">{{ mv }}</option>
    {% endfor %}
  </select>

  <!-- 체인 -->
  <label style="margin-left:1rem;">영화관 체인</label>
  <select id="chain" required>
    <option value="">-- 체인 --</option>
    {% for chain in catalog.keys() %}
      <option value="{{ chain }}">{{ chain }}</option>
    {% endfor %}
  </select>

  <!-- 지점 -->
  <label style="margin-left:1rem;">지점</label>
  <select id="theaterSelect" name="theater" required>
    <option value="">-- 지점 --</option>
  </select>

  <!-- 상영관 (선택) -->
  <label style="margin-left:1rem;">상영관</label>
  <select id="screenSelect" name="screen">
    <option value="">(선택)</option>
  </select>

  <div style="margin-top:1rem;">
    <button type="submit">저장</button>
  </div>
</form>

<script>
  // 서버에서 전달된 catalog 객체를 JS로 사용하기 위해 JSON 직렬화
  const CATALOG = {{ catalog|tojson }};

  const chainEl = document.getElementById('chain');
  const theaterEl = document.getElementById('theaterSelect');
  const screenEl = document.getElementById('screenSelect');

  chainEl.addEventListener('change', () => {
    const chain = chainEl.value;
    theaterEl.innerHTML = '<option value="">-- 지점 --</option>';
    screenEl.innerHTML = '<option value="">(선택)</option>';
    if (!chain || !CATALOG[chain]) return;

    // 지점 목록 채우기
    Object.keys(CATALOG[chain]).forEach((theater) => {
      const opt = document.createElement('option');
      opt.value = theater; opt.textContent = theater;
      theaterEl.appendChild(opt);
    });
  });

  theaterEl.addEventListener('change', () => {
    const chain = chainEl.value;
    const theater = theaterEl.value;
    screenEl.innerHTML = '<option value="">(선택)</option>';
    if (!chain || !theater) return;

    const screens = (CATALOG[chain][theater] || {}).screens || [];
    screens.forEach((sc) => {
      const opt = document.createElement('option');
      opt.value = sc; opt.textContent = sc;
      screenEl.appendChild(opt);
    });
  });
</script>
{% endblock %}

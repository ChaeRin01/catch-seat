{% extends "base.html" %}
{% block content %}
<h1>좌석 취소 알림 신청</h1>

<form method="post">
  <!-- 영화 -->
  <label>영화</label>
  <select name="movie" required>
    <option value="">-- 영화 선택 --</option>
    {% for mv in movies %}
      <option value="{{ mv }}">{{ mv }}</option>
    {% endfor %}
  </select>

  <!-- 체인 -->
  <label style="margin-left:1rem;">영화관 체인</label>
  <select id="chain" required>
    <option value="">-- 체인 --</option>
    {% for chain in catalog.keys() %}
      <option value="{{ chain }}">{{ chain }}</option>
    {% endfor %}
  </select>

  <!-- 지점 -->
  <label style="margin-left:1rem;">지점</label>
  <select id="theaterSelect" name="theater" required>
    <option value="">-- 지점 --</option>
  </select>

  <!-- 상영일시 (더미 showtimes 선택식) -->
  <label style="margin-left:1rem;">상영일시</label>
  <select id="showtimeSelect" name="show_datetime" required>
    <option value="">-- 일시 선택 --</option>
  </select>

  <!-- 희망좌석 -->
  <div style="margin-top:1rem;">
    <label>희망좌석 (쉼표구분, 예: E11,E12)</label>
    <input type="text" name="desired_seats" required placeholder="E11,E12" />
  </div>

  <div style="margin-top:1rem;">
    <button type="submit">저장</button>
  </div>
</form>

<script>
  const CATALOG = {{ catalog|tojson }};

  const chainEl = document.getElementById('chain');
  const theaterEl = document.getElementById('theaterSelect');
  const showtimeEl = document.getElementById('showtimeSelect');

  chainEl.addEventListener('change', () => {
    const chain = chainEl.value;
    theaterEl.innerHTML = '<option value="">-- 지점 --</option>';
    showtimeEl.innerHTML = '<option value="">-- 일시 선택 --</option>';
    if (!chain || !CATALOG[chain]) return;

    Object.keys(CATALOG[chain]).forEach((theater) => {
      const opt = document.createElement('option');
      opt.value = theater; opt.textContent = theater;
      theaterEl.appendChild(opt);
    });
  });

  theaterEl.addEventListener('change', () => {
    const chain = chainEl.value;
    const theater = theaterEl.value;
    showtimeEl.innerHTML = '<option value="">-- 일시 선택 --</option>';
    if (!chain || !theater) return;

    const showtimes = (CATALOG[chain][theater] || {}).showtimes || [];
    showtimes.forEach((st) => {
      const opt = document.createElement('option');
      opt.value = st; opt.textContent = st;
      showtimeEl.appendChild(opt);
    });
  });
</script>
{% endblock %}
